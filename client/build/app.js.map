{"version":3,"file":"app.js","sources":["../src/media.js","../../../../../../usr/local/lib/node_modules/greni/node_modules/svelte/shared.js","../src/components/AlbumsView.html","../src/main.js"],"sourcesContent":["function ntoh(bytes, offset=0) {\n    return (bytes[3 + offset] << 0) |\n           (bytes[2 + offset] << 8) |\n           (bytes[1 + offset] << 16) |\n           (bytes[0 + offset] << 24)\n}\n\n// Fisher-Yates Shuffle\nfunction shuffle(array) {\n    let counter = array.length\n    let temp\n    let index\n\n    // While there are elements in the array\n    while (counter > 0) {\n        // Pick a random index\n        index = Math.floor(Math.random() * counter)\n        counter -= 1\n\n        // And swap the last element with it\n        temp = array[counter]\n        array[counter] = array[index]\n        array[index] = temp\n    }\n\n    return array\n}\n\nexport class Album {\n    constructor(id, title, albumArtist, year, tracks) {\n        this.id = id\n        this.title = title\n        this.albumArtist = albumArtist\n        this.year = year\n        this.tracks = tracks\n        this.thumbnail = null\n\n        this.haveCover = true\n    }\n\n    compare(other) {\n        const thisCompiler = this.albumArtist.toLowerCase().split(/^\"|the\\W/i).join('')\n        const otherCompiler = other.albumArtist.toLowerCase().split(/^\"|the\\W/i).join('')\n\n        if(thisCompiler > otherCompiler) { return 1 }\n        if(thisCompiler < otherCompiler) { return -1 }\n\n        // Tie-break using year\n        if(this.year > other.year) { return 1 }\n        if(this.year < other.year) { return -1 }\n\n        return 0\n    }\n\n    static parse(data) {\n        return new Album(data.id, data.title, data.album_artist, data.year, data.tracks)\n    }\n}\n\nexport class Song {\n    constructor(id, title, artist) {\n        this.id = id\n        this.title = title\n        this.artist = artist\n    }\n\n    stream() {\n        return `/music/song/${this.id}/stream`\n    }\n\n    static parse(data) {\n        return new Song(data.id, data.title, data.artist)\n    }\n}\n\nexport class MediaLibrary {\n    constructor(root) {\n        this.root = root\n\n        this.songs = []\n        this.albums = []\n        this.thumbnails = new Map()\n\n        this.songCache = new Map()\n        this.albumCache = new Map()\n\n        // this.artistIndex = new Map()\n        this.albumIndex = new Map()\n    }\n\n    async refresh() {\n        const songs = []\n        const songCache = new Map()\n        const newAlbumIndex = new Map()\n\n        try {\n            const response = await self.fetch(`${this.root}/music/songs`)\n            const data = await response.json()\n            for(const rawSong of data.songs) {\n                songs.push(rawSong.id)\n                newAlbumIndex.set(rawSong.id, rawSong.album_id)\n\n                try {\n                    songCache.set(rawSong.id, Song.parse(rawSong))\n                } catch(err) {\n                    console.error(`Error parsing song ${rawSong.id}`)\n                    console.error(err)\n                }\n            }\n        } catch (err) {\n            console.error('Error getting song manifest', err)\n            return\n        }\n\n        this.songs = songs\n        this.songCache = songCache\n        this.albumIndex = newAlbumIndex\n        this.albums = await this.getAlbums()\n\n        await this.getThumbnails()\n    }\n\n    async shuffle() {\n        shuffle(this.songs)\n        return this.songs\n    }\n\n    songUrl(song) {\n        return this.root + song.stream()\n    }\n\n    getSong(id) {\n        if(this.songCache.has(id)) {\n            return this.songCache.get(id)\n        } else {\n            return null\n        }\n    }\n\n    getCover(album) {\n        return `${this.root}/music/album/${album.id}/cover`\n    }\n\n    async getThumbnails() {\n        const albumList = Array.from(this.albums)\n        const query = albumList.map((album) => encodeURIComponent(album.id)).join(',')\n        const response = await fetch(`${this.root}/music/thumbnail?ids=${query}`)\n        const body = await response.arrayBuffer()\n        const view = new Uint8Array(body)\n\n        let offset = 0\n        const thumbnails = []\n        while (offset < view.length) {\n            const messageLength = ntoh(view, offset)\n            offset += 4\n\n            if (messageLength === 0) {\n                thumbnails.push(null)\n                continue\n            }\n\n            const blob = new Blob([view.slice(offset, messageLength + offset)], { type: 'image/jpeg' })\n            offset += messageLength\n            const url = URL.createObjectURL(blob)\n            thumbnails.push(url)\n        }\n\n        for (const albumID of this.thumbnails.keys()) {\n            URL.revokeObjectURL(this.thumbnails.get(albumID))\n        }\n\n        this.thumbnails.clear()\n        for (let i = 0; i < thumbnails.length; i += 1) {\n            if (thumbnails[i] !== null) {\n                this.thumbnails.set(albumList[i].id, thumbnails[i])\n            }\n        }\n    }\n\n    async getAlbums() {\n        const response = await self.fetch(`${this.root}/music/albums`)\n        const data = await response.json()\n        const albums = []\n        for (const rawAlbum of data.albums) {\n            const album = Album.parse(rawAlbum)\n            this.albumCache.set(album.id, album)\n            albums.push(album)\n        }\n\n        return albums.sort((a, b) => a.compare(b))\n    }\n\n    async getAlbum(id) {\n        if(this.albumCache.has(id)) {\n            return this.albumCache.get(id)\n        }\n\n        const response = await self.fetch(`${this.root}/music/album/${id}/metadata`)\n        const data = await response.json()\n        const album = Album.parse(data)\n        this.albumCache.set(id, album)\n        return album\n    }\n\n    getAlbumBySong(id) {\n        return this.getAlbum(this.albumIndex.get(id))\n    }\n}\n","function noop() {}\n\nfunction assign(target) {\n\tvar k,\n\t\tsource,\n\t\ti = 1,\n\t\tlen = arguments.length;\n\tfor (; i < len; i++) {\n\t\tsource = arguments[i];\n\t\tfor (k in source) target[k] = source[k];\n\t}\n\n\treturn target;\n}\n\nfunction appendNode(node, target) {\n\ttarget.appendChild(node);\n}\n\nfunction insertNode(node, target, anchor) {\n\ttarget.insertBefore(node, anchor);\n}\n\nfunction detachNode(node) {\n\tnode.parentNode.removeChild(node);\n}\n\nfunction detachBetween(before, after) {\n\twhile (before.nextSibling && before.nextSibling !== after) {\n\t\tbefore.parentNode.removeChild(before.nextSibling);\n\t}\n}\n\nfunction detachBefore(after) {\n\twhile (after.previousSibling) {\n\t\tafter.parentNode.removeChild(after.previousSibling);\n\t}\n}\n\nfunction detachAfter(before) {\n\twhile (before.nextSibling) {\n\t\tbefore.parentNode.removeChild(before.nextSibling);\n\t}\n}\n\nfunction reinsertBetween(before, after, target) {\n\twhile (before.nextSibling && before.nextSibling !== after) {\n\t\ttarget.appendChild(before.parentNode.removeChild(before.nextSibling));\n\t}\n}\n\nfunction reinsertChildren(parent, target) {\n\twhile (parent.firstChild) target.appendChild(parent.firstChild);\n}\n\nfunction reinsertAfter(before, target) {\n\twhile (before.nextSibling) target.appendChild(before.nextSibling);\n}\n\nfunction reinsertBefore(after, target) {\n\tvar parent = after.parentNode;\n\twhile (parent.firstChild !== after) target.appendChild(parent.firstChild);\n}\n\n// TODO this is out of date\nfunction destroyEach(iterations, detach, start) {\n\tfor (var i = start; i < iterations.length; i += 1) {\n\t\tif (iterations[i]) iterations[i].destroy(detach);\n\t}\n}\n\nfunction createFragment() {\n\treturn document.createDocumentFragment();\n}\n\nfunction createElement(name) {\n\treturn document.createElement(name);\n}\n\nfunction createSvgElement(name) {\n\treturn document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nfunction createText(data) {\n\treturn document.createTextNode(data);\n}\n\nfunction createComment() {\n\treturn document.createComment('');\n}\n\nfunction addListener(node, event, handler) {\n\tnode.addEventListener(event, handler, false);\n}\n\nfunction removeListener(node, event, handler) {\n\tnode.removeEventListener(event, handler, false);\n}\n\nfunction setAttribute(node, attribute, value) {\n\tnode.setAttribute(attribute, value);\n}\n\nfunction setXlinkAttribute(node, attribute, value) {\n\tnode.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\n\nfunction getBindingGroupValue(group) {\n\tvar value = [];\n\tfor (var i = 0; i < group.length; i += 1) {\n\t\tif (group[i].checked) value.push(group[i].__value);\n\t}\n\treturn value;\n}\n\nfunction toNumber(value) {\n\treturn value === '' ? undefined : +value;\n}\n\nfunction timeRangesToArray(ranges) {\n\tvar array = [];\n\tfor (var i = 0; i < ranges.length; i += 1) {\n\t\tarray.push({ start: ranges.start(i), end: ranges.end(i) });\n\t}\n\treturn array;\n}\n\nfunction children (element) {\n\treturn Array.from(element.childNodes);\n}\n\nfunction claimElement (nodes, name, attributes, svg) {\n\tfor (var i = 0; i < nodes.length; i += 1) {\n\t\tvar node = nodes[i];\n\t\tif (node.nodeName === name) {\n\t\t\tfor (var j = 0; j < node.attributes.length; j += 1) {\n\t\t\t\tvar attribute = node.attributes[j];\n\t\t\t\tif (!attributes[attribute.name]) node.removeAttribute(attribute.name);\n\t\t\t}\n\t\t\treturn nodes.splice(i, 1)[0]; // TODO strip unwanted attributes\n\t\t}\n\t}\n\n\treturn svg ? createSvgElement(name) : createElement(name);\n}\n\nfunction claimText (nodes, data) {\n\tfor (var i = 0; i < nodes.length; i += 1) {\n\t\tvar node = nodes[i];\n\t\tif (node.nodeType === 3) {\n\t\t\tnode.data = data;\n\t\t\treturn nodes.splice(i, 1)[0];\n\t\t}\n\t}\n\n\treturn createText(data);\n}\n\nfunction setInputType(input, type) {\n\ttry {\n\t\tinput.type = type;\n\t} catch (e) {}\n}\n\nfunction setStyle(node, key, value) {\n\tnode.style.setProperty(key, value);\n}\n\nfunction linear(t) {\n\treturn t;\n}\n\nfunction generateRule(\n\ta,\n\tb,\n\tdelta,\n\tduration,\n\tease,\n\tfn\n) {\n\tvar keyframes = '{\\n';\n\n\tfor (var p = 0; p <= 1; p += 16.666 / duration) {\n\t\tvar t = a + delta * ease(p);\n\t\tkeyframes += p * 100 + '%{' + fn(t) + '}\\n';\n\t}\n\n\treturn keyframes + '100% {' + fn(b) + '}\\n}';\n}\n\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n\tvar hash = 5381;\n\tvar i = str.length;\n\n\twhile (i--) hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n\treturn hash >>> 0;\n}\n\nfunction wrapTransition(component, node, fn, params, intro, outgroup) {\n\tvar obj = fn(node, params);\n\tvar duration = obj.duration || 300;\n\tvar ease = obj.easing || linear;\n\tvar cssText;\n\n\t// TODO share <style> tag between all transitions?\n\tif (obj.css && !transitionManager.stylesheet) {\n\t\tvar style = createElement('style');\n\t\tdocument.head.appendChild(style);\n\t\ttransitionManager.stylesheet = style.sheet;\n\t}\n\n\tif (intro) {\n\t\tif (obj.css && obj.delay) {\n\t\t\tcssText = node.style.cssText;\n\t\t\tnode.style.cssText += obj.css(0);\n\t\t}\n\n\t\tif (obj.tick) obj.tick(0);\n\t}\n\n\treturn {\n\t\tt: intro ? 0 : 1,\n\t\trunning: false,\n\t\tprogram: null,\n\t\tpending: null,\n\t\trun: function(intro, callback) {\n\t\t\tvar program = {\n\t\t\t\tstart: window.performance.now() + (obj.delay || 0),\n\t\t\t\tintro: intro,\n\t\t\t\tcallback: callback\n\t\t\t};\n\n\t\t\tif (obj.delay) {\n\t\t\t\tthis.pending = program;\n\t\t\t} else {\n\t\t\t\tthis.start(program);\n\t\t\t}\n\n\t\t\tif (!this.running) {\n\t\t\t\tthis.running = true;\n\t\t\t\ttransitionManager.add(this);\n\t\t\t}\n\t\t},\n\t\tstart: function(program) {\n\t\t\tcomponent.fire(program.intro ? 'intro.start' : 'outro.start', { node: node });\n\n\t\t\tprogram.a = this.t;\n\t\t\tprogram.b = program.intro ? 1 : 0;\n\t\t\tprogram.delta = program.b - program.a;\n\t\t\tprogram.duration = duration * Math.abs(program.b - program.a);\n\t\t\tprogram.end = program.start + program.duration;\n\n\t\t\tif (obj.css) {\n\t\t\t\tif (obj.delay) node.style.cssText = cssText;\n\n\t\t\t\tprogram.rule = generateRule(\n\t\t\t\t\tprogram.a,\n\t\t\t\t\tprogram.b,\n\t\t\t\t\tprogram.delta,\n\t\t\t\t\tprogram.duration,\n\t\t\t\t\tease,\n\t\t\t\t\tobj.css\n\t\t\t\t);\n\n\t\t\t\ttransitionManager.addRule(program.rule, program.name = '__svelte_' + hash(program.rule));\n\n\t\t\t\tnode.style.animation = (node.style.animation || '')\n\t\t\t\t\t.split(', ')\n\t\t\t\t\t.filter(function(anim) {\n\t\t\t\t\t\t// when introing, discard old animations if there are any\n\t\t\t\t\t\treturn anim && (program.delta < 0 || !/__svelte/.test(anim));\n\t\t\t\t\t})\n\t\t\t\t\t.concat(program.name + ' ' + duration + 'ms linear 1 forwards')\n\t\t\t\t\t.join(', ');\n\t\t\t}\n\n\t\t\tthis.program = program;\n\t\t\tthis.pending = null;\n\t\t},\n\t\tupdate: function(now) {\n\t\t\tvar program = this.program;\n\t\t\tif (!program) return;\n\n\t\t\tvar p = now - program.start;\n\t\t\tthis.t = program.a + program.delta * ease(p / program.duration);\n\t\t\tif (obj.tick) obj.tick(this.t);\n\t\t},\n\t\tdone: function() {\n\t\t\tvar program = this.program;\n\t\t\tthis.t = program.b;\n\t\t\tif (obj.tick) obj.tick(this.t);\n\t\t\tif (obj.css) transitionManager.deleteRule(node, program.name);\n\t\t\tprogram.callback();\n\t\t\tprogram = null;\n\t\t\tthis.running = !!this.pending;\n\t\t},\n\t\tabort: function() {\n\t\t\tif (obj.tick) obj.tick(1);\n\t\t\tif (obj.css) transitionManager.deleteRule(node, this.program.name);\n\t\t\tthis.program = this.pending = null;\n\t\t\tthis.running = false;\n\t\t}\n\t};\n}\n\nvar transitionManager = {\n\trunning: false,\n\ttransitions: [],\n\tbound: null,\n\tstylesheet: null,\n\tactiveRules: {},\n\n\tadd: function(transition) {\n\t\tthis.transitions.push(transition);\n\n\t\tif (!this.running) {\n\t\t\tthis.running = true;\n\t\t\trequestAnimationFrame(this.bound || (this.bound = this.next.bind(this)));\n\t\t}\n\t},\n\n\taddRule: function(rule, name) {\n\t\tif (!this.activeRules[name]) {\n\t\t\tthis.activeRules[name] = true;\n\t\t\tthis.stylesheet.insertRule('@keyframes ' + name + ' ' + rule, this.stylesheet.cssRules.length);\n\t\t}\n\t},\n\n\tnext: function() {\n\t\tthis.running = false;\n\n\t\tvar now = window.performance.now();\n\t\tvar i = this.transitions.length;\n\n\t\twhile (i--) {\n\t\t\tvar transition = this.transitions[i];\n\n\t\t\tif (transition.program && now >= transition.program.end) {\n\t\t\t\ttransition.done();\n\t\t\t}\n\n\t\t\tif (transition.pending && now >= transition.pending.start) {\n\t\t\t\ttransition.start(transition.pending);\n\t\t\t}\n\n\t\t\tif (transition.running) {\n\t\t\t\ttransition.update(now);\n\t\t\t\tthis.running = true;\n\t\t\t} else if (!transition.pending) {\n\t\t\t\tthis.transitions.splice(i, 1);\n\t\t\t}\n\t\t}\n\n\t\tif (this.running) {\n\t\t\trequestAnimationFrame(this.bound);\n\t\t} else if (this.stylesheet) {\n\t\t\tvar i = this.stylesheet.cssRules.length;\n\t\t\twhile (i--) this.stylesheet.deleteRule(i);\n\t\t\tthis.activeRules = {};\n\t\t}\n\t},\n\n\tdeleteRule: function(node, name) {\n\t\tnode.style.animation = node.style.animation\n\t\t\t.split(', ')\n\t\t\t.filter(function(anim) {\n\t\t\t\treturn anim.slice(0, name.length) !== name;\n\t\t\t})\n\t\t\t.join(', ');\n\t}\n};\n\nfunction destroy(detach) {\n\tthis.destroy = noop;\n\tthis.fire('destroy');\n\tthis.set = this.get = noop;\n\n\tif (detach !== false) this._fragment.unmount();\n\tthis._fragment.destroy();\n\tthis._fragment = this._state = null;\n}\n\nfunction destroyDev(detach) {\n\tdestroy.call(this, detach);\n\tthis.destroy = function() {\n\t\tconsole.warn('Component was already destroyed');\n\t};\n}\n\nfunction differs(a, b) {\n\treturn a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\n\nfunction dispatchObservers(component, group, changed, newState, oldState) {\n\tfor (var key in group) {\n\t\tif (!changed[key]) continue;\n\n\t\tvar newValue = newState[key];\n\t\tvar oldValue = oldState[key];\n\n\t\tvar callbacks = group[key];\n\t\tif (!callbacks) continue;\n\n\t\tfor (var i = 0; i < callbacks.length; i += 1) {\n\t\t\tvar callback = callbacks[i];\n\t\t\tif (callback.__calling) continue;\n\n\t\t\tcallback.__calling = true;\n\t\t\tcallback.call(component, newValue, oldValue);\n\t\t\tcallback.__calling = false;\n\t\t}\n\t}\n}\n\nfunction get(key) {\n\treturn key ? this._state[key] : this._state;\n}\n\nfunction fire(eventName, data) {\n\tvar handlers =\n\t\teventName in this._handlers && this._handlers[eventName].slice();\n\tif (!handlers) return;\n\n\tfor (var i = 0; i < handlers.length; i += 1) {\n\t\thandlers[i].call(this, data);\n\t}\n}\n\nfunction observe(key, callback, options) {\n\tvar group = options && options.defer\n\t\t? this._observers.post\n\t\t: this._observers.pre;\n\n\t(group[key] || (group[key] = [])).push(callback);\n\n\tif (!options || options.init !== false) {\n\t\tcallback.__calling = true;\n\t\tcallback.call(this, this._state[key]);\n\t\tcallback.__calling = false;\n\t}\n\n\treturn {\n\t\tcancel: function() {\n\t\t\tvar index = group[key].indexOf(callback);\n\t\t\tif (~index) group[key].splice(index, 1);\n\t\t}\n\t};\n}\n\nfunction observeDev(key, callback, options) {\n\tvar c = (key = '' + key).search(/[^\\w]/);\n\tif (c > -1) {\n\t\tvar message =\n\t\t\t'The first argument to component.observe(...) must be the name of a top-level property';\n\t\tif (c > 0)\n\t\t\tmessage += \", i.e. '\" + key.slice(0, c) + \"' rather than '\" + key + \"'\";\n\n\t\tthrow new Error(message);\n\t}\n\n\treturn observe.call(this, key, callback, options);\n}\n\nfunction on(eventName, handler) {\n\tif (eventName === 'teardown') return this.on('destroy', handler);\n\n\tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n\thandlers.push(handler);\n\n\treturn {\n\t\tcancel: function() {\n\t\t\tvar index = handlers.indexOf(handler);\n\t\t\tif (~index) handlers.splice(index, 1);\n\t\t}\n\t};\n}\n\nfunction onDev(eventName, handler) {\n\tif (eventName === 'teardown') {\n\t\tconsole.warn(\n\t\t\t\"Use component.on('destroy', ...) instead of component.on('teardown', ...) which has been deprecated and will be unsupported in Svelte 2\"\n\t\t);\n\t\treturn this.on('destroy', handler);\n\t}\n\n\treturn on.call(this, eventName, handler);\n}\n\nfunction set(newState) {\n\tthis._set(assign({}, newState));\n\tif (this._root._lock) return;\n\tthis._root._lock = true;\n\tcallAll(this._root._beforecreate);\n\tcallAll(this._root._oncreate);\n\tcallAll(this._root._aftercreate);\n\tthis._root._lock = false;\n}\n\nfunction _set(newState) {\n\tvar oldState = this._state,\n\t\tchanged = {},\n\t\tdirty = false;\n\n\tfor (var key in newState) {\n\t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n\t}\n\tif (!dirty) return;\n\n\tthis._state = assign({}, oldState, newState);\n\tthis._recompute(changed, this._state, oldState, false);\n\tif (this._bind) this._bind(changed, this._state);\n\tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n\tthis._fragment.update(changed, this._state);\n\tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n}\n\nfunction _setDev(newState) {\n\tif (typeof newState !== 'object') {\n\t\tthrow new Error(\n\t\t\tthis._debugName + ' .set was called without an object of data key-values to update.'\n\t\t);\n\t}\n\n\tthis._checkReadOnly(newState);\n\t_set.call(this, newState);\n}\n\nfunction callAll(fns) {\n\twhile (fns && fns.length) fns.pop()();\n}\n\nfunction _mount(target, anchor) {\n\tthis._fragment.mount(target, anchor);\n}\n\nfunction _unmount() {\n\tthis._fragment.unmount();\n}\n\nvar proto = {\n\tdestroy: destroy,\n\tget: get,\n\tfire: fire,\n\tobserve: observe,\n\ton: on,\n\tset: set,\n\tteardown: destroy,\n\t_recompute: noop,\n\t_set: _set,\n\t_mount: _mount,\n\t_unmount: _unmount\n};\n\nvar protoDev = {\n\tdestroy: destroyDev,\n\tget: get,\n\tfire: fire,\n\tobserve: observeDev,\n\ton: onDev,\n\tset: set,\n\tteardown: destroyDev,\n\t_recompute: noop,\n\t_set: _setDev,\n\t_mount: _mount,\n\t_unmount: _unmount\n};\n\nexport { destroy, destroyDev, differs, dispatchObservers, get, fire, observe, observeDev, on, onDev, set, _set, _setDev, callAll, _mount, _unmount, proto, protoDev, appendNode, insertNode, detachNode, detachBetween, detachBefore, detachAfter, reinsertBetween, reinsertChildren, reinsertAfter, reinsertBefore, destroyEach, createFragment, createElement, createSvgElement, createText, createComment, addListener, removeListener, setAttribute, setXlinkAttribute, getBindingGroupValue, toNumber, timeRangesToArray, children, claimElement, claimText, setInputType, setStyle, linear, generateRule, hash, wrapTransition, transitionManager, noop, assign };\n","{{ #if show }}\n<div class=\"album-list\">\n    <div on:click=\"fire('shuffle')\">\n        <span class=\"fa fa-random\" title=\"Shuffle\"></span>\n    </div>\n\n    {{ #each library.albums as album }}\n    <div on:click=\"fire('select', album)\">\n    {{ #if library.thumbnails.has(album.id) }}\n        <img width=100 height=100 src=\"{{ library.thumbnails.get(album.id) }}\" alt=\"{{ album.albumArtist }} - {{ album.title }}\">\n    {{ else }}\n        <div>{{ album.albumArtist }}</div>\n        <div>{{ album.title }}</div>\n    {{ /if }}\n    </div>\n    {{ /each }}\n</div>\n{{ /if }}\n\n<style>\n.album-list {\n    display: flex;\n    flex-wrap: wrap;\n    position: absolute;\n    top: 50px;\n}\n\n.album-list > div {\n    background-color: #444;\n    color: white;\n    font-size: 80%;\n    font-family: sans-serif;\n    width: 100px;\n    height: 100px;\n    background-size: cover;\n    margin-left: 2px;\n    margin-right: 2px;\n\n    cursor: pointer;\n    position: relative;\n    transition: all 0.25s;\n\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n}\n\n.album-list > div > div {\n    padding-top: 5px;\n    padding-bottom: 5px;\n    pointer-events: none;\n}\n\n.album-list > div:active { top: -6px; }\n\n.album-list > div:first-child {\n    font-size: 100%;\n    background-color: transparent;\n}\n</style>\n\n<script>\nexport default {\n    data () {\n        return {\n            show: false\n        };\n    }\n};\n</script>\n","import * as media from './media'\nimport AlbumsView from './components/AlbumsView.html'\n\nconst EMPTY_IMAGE = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP'\n\nclass Player {\n    constructor(library) {\n        this.playing = null\n        this.paused = null\n        this.library = library\n        this.playlist = []\n        this.playlistPosition = 0\n        this.onplay = () => {}\n\n        this._initElement()\n    }\n\n    play(songs) {\n        this.playlist = songs\n        this.doPlay(0)\n    }\n\n    togglePause() {\n        if(this.paused) {\n            this.element.play()\n            this.playing = this.paused\n            this.paused = null\n            this.onplay()\n            return\n        }\n\n        this.element.pause()\n        this.paused = this.playing\n        this.playing = null\n        this.onplay()\n    }\n\n    skip() {\n        this.doPlay(1)\n    }\n\n    back() {\n        if (!this.element) {\n            return\n        }\n\n        if (this.element.currentTime >= 4 || this.playlistPosition === 0) {\n            this.element.currentTime = 0\n        } else {\n            this.doPlay(-1)\n        }\n    }\n\n    shuffle() {\n        this.library.shuffle().then((ids) => ids.map((id) => {\n            return this.library.getSong(id)\n        })).then((songs) => {\n            this.play(songs)\n        })\n    }\n\n    doPlay(skipNumber) {\n        this.paused = null\n        this.playing = null\n        if(this.playlistPosition >= this.playlist.length) {\n            this.onplay()\n\n            // Don't pause an errored stream. This can cause a nasty\n            // error loop, where pausing triggers reparsing bad input.\n            if(!this.element.error) {\n                this.element.pause()\n            }\n            return\n        }\n\n        this.playlistPosition += skipNumber\n        const song = this.playlist[this.playlistPosition]\n        this.playing = song\n        this.element.src = this.library.songUrl(song)\n        this.element.play()\n\n        this.onplay()\n    }\n\n    _initElement() {\n        this.element = document.createElement('audio')\n        this.element.controls = false\n\n        this.element.onended = () => {\n            this.doPlay(1)\n        }\n\n        this.element.onerror = () => {\n            const id = this.playing? this.playing.id : 'unknown'\n            console.error(`Error playing ${id}`)\n            this.doPlay(1)\n        }\n    }\n}\n\nclass CoverSwitcher {\n    constructor(elements) {\n        this.elements = elements.slice(0, 2)\n        this.curCover = null\n        this.cur = 0\n    }\n\n    switch(url) {\n        if(url === this.curCover) { return }\n\n        this.curCover = url\n\n        this.currentElement.classList.add('old')\n        this.cur = (this.cur + 1) % 2\n        this.currentElement.classList.remove('old')\n\n        if(url === null) {\n            this.currentElement.src = EMPTY_IMAGE\n            return\n        }\n\n        this.currentElement.src = url\n    }\n\n    get currentElement() {\n        return this.elements[this.cur]\n    }\n}\n\nfunction main() {\n    const backButton = document.getElementById('back-button')\n    const playButton = document.getElementById('play-button')\n    const skipButton = document.getElementById('skip-button')\n    const labelElement = document.getElementById('caption')\n\n    const coverSwitcher = new CoverSwitcher(Array.from(document.getElementsByClassName('cover')))\n    const library = new media.MediaLibrary('/api')\n    const player = new Player(library)\n\n    library.refresh()\n\n    player.onplay = () => {\n        const song = player.playing || player.paused\n\n        if(song) {\n            labelElement.textContent = `${song.artist} - ${song.title}`\n\n            library.getAlbumBySong(song.id).then((album) => {\n                coverSwitcher.switch(library.getCover(album))\n            })\n        } else {\n            coverSwitcher.switch(null)\n            labelElement.textContent = ''\n        }\n\n        if(player.playing) {\n            playButton.className = 'fa fa-pause playing'\n        } else {\n            playButton.className = 'fa fa-play'\n        }\n    }\n\n    backButton.addEventListener('click', function() {\n        player.back()\n    })\n\n    playButton.addEventListener('click', function() {\n        if(player.playing) {\n            player.togglePause()\n        } else if(player.paused) {\n            player.togglePause()\n        } else {\n            player.shuffle()\n        }\n    })\n\n    skipButton.addEventListener('click', function() {\n        player.skip()\n    })\n\n    const albumsButton = document.getElementById('albums-button')\n    const albumsView = new AlbumsView({\n        target: document.getElementById('album-list'),\n        data: { library }\n    })\n\n    albumsView.on('shuffle', () => {\n        player.shuffle()\n        albumsView.set({ show: false })\n    })\n\n    albumsView.on('select', (album) => {\n        const songs = album.tracks.map((id) => {\n            return library.getSong(id)\n        })\n\n        player.play(songs)\n        albumsView.set({ show: false })\n    })\n\n    albumsButton.addEventListener('click', function() {\n        albumsView.set({ show: !albumsView.get('show') })\n    })\n}\n\nwindow.addEventListener('DOMContentLoaded', function() {\n    main()\n})\n"],"names":["ntoh","bytes","offset","shuffle","array","temp","index","counter","length","Math","floor","random","noop","assign","target","k","source","i","len","arguments","appendNode","node","appendChild","insertNode","anchor","insertBefore","detachNode","parentNode","removeChild","destroyEach","iterations","detach","start","destroy","createElement","name","document","createText","data","createTextNode","createComment","addListener","event","handler","addEventListener","removeListener","removeEventListener","setAttribute","attribute","value","this","fire","set","get","_fragment","unmount","_state","differs","a","b","dispatchObservers","component","group","changed","newState","oldState","key","newValue","oldValue","callbacks","callback","__calling","call","callAll","fns","pop","if_block","state","create_if_block","show","img","src","img_src_value","library","thumbnails","album","id","alt","img_alt_value","albumArtist","title","div","text","text_1","div_1","text_2","text_value","text_2_value","each_block_value","albums","each_block_iterations","has","create_if_block_1","main","backButton","getElementById","playButton","skipButton","labelElement","coverSwitcher","CoverSwitcher","Array","from","getElementsByClassName","media.MediaLibrary","player","Player","refresh","onplay","song","playing","paused","textContent","artist","getAlbumBySong","then","switch","getCover","className","back","togglePause","skip","albumsButton","albumsView","AlbumsView","on","songs","tracks","map","getSong","play","Album","[object Object]","year","thumbnail","haveCover","other","thisCompiler","toLowerCase","split","join","otherCompiler","album_artist","Song","MediaLibrary","root","Map","songCache","albumCache","albumIndex","newAlbumIndex","response","self","fetch","json","rawSong","push","album_id","parse","err","console","error","getAlbums","getThumbnails","stream","albumList","query","encodeURIComponent","body","arrayBuffer","view","Uint8Array","messageLength","blob","Blob","slice","type","url","URL","createObjectURL","albumID","keys","revokeObjectURL","clear","rawAlbum","sort","compare","getAlbum","proto","eventName","handlers","_handlers","observe","options","defer","_observers","post","pre","init","cancel","indexOf","splice","_set","_root","_lock","_beforecreate","_oncreate","_aftercreate","teardown","_recompute","dirty","_bind","update","_mount","mount","_unmount","template","EMPTY_IMAGE","playlist","playlistPosition","_initElement","doPlay","element","pause","currentTime","ids","skipNumber","songUrl","controls","onended","onerror","elements","curCover","cur","currentElement","classList","add","remove","window"],"mappings":"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"}